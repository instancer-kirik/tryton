# Tryton Configuration for Railway Deployment
# Optimized for DivvyQueue integration

[database]
# Use Railway's DATABASE_URL environment variable
uri = env://DATABASE_URL
path = /tmp/tryton_db

[web]
# Bind to all interfaces on Railway's assigned port
listen = 0.0.0.0:${PORT}
hostname = ${RAILWAY_PUBLIC_DOMAIN}
root = /app/sao

# Enable CORS for DivvyQueue frontend
[cors]
origins = ${CORS_ORIGINS}
methods = GET,POST,PUT,DELETE,OPTIONS
headers = Content-Type,Authorization,X-Requested-With
credentials = true

[session]
# Session configuration
timeout = ${SESSION_TIMEOUT}
max_age = 86400
super_pwd = ${TRYTON_ADMIN_PASSWORD}

[cache]
# Use Redis if available, fallback to memory cache
uri = ${REDIS_URL}
class = trytond.cache.RedisCache
prefix = tryton:
timeout = ${CACHE_TIMEOUT}
# Fallback configuration
# class = trytond.cache.MemoryCache
model = 200
record = 2000
field = 100
default_timeout = 300

[request]
# Request size limits
max_size = ${MAX_REQUEST_SIZE}
max_size_authenticated = ${MAX_REQUEST_SIZE}

[email]
# Email configuration for notifications
uri = smtp://${EMAIL_USER}:${EMAIL_PASSWORD}@${EMAIL_HOST}:${EMAIL_PORT}
tls = ${EMAIL_USE_TLS}

# JSON-RPC configuration (primary API for DivvyQueue)
[jsonrpc]
listen = 0.0.0.0:${PORT}
data_time_limit = 300

# Disable XML-RPC for security (only use JSON-RPC)
[xmlrpc]
# Disabled for Railway deployment

# Security settings
[password]
length = 12
entropy = 0.8
# Hash rounds for bcrypt
rounds = 12

# File upload configuration
[attachment]
store_prefix = ${UPLOAD_PATH}
filestore = true

# Logging configuration
[logging]
level = ${LOG_LEVEL}
disable_existing_loggers = false

# Logger configurations
[[logging.loggers]]
name = "trytond"
level = ${LOG_LEVEL}
handlers = ["console"]

[[logging.loggers]]
name = "trytond.rpc"
level = ${LOG_LEVEL}
handlers = ["console"]

[[logging.loggers]]
name = "trytond.pool"
level = "WARNING"
handlers = ["console"]

# Console handler for Railway logs
[[logging.handlers]]
name = "console"
class = "logging.StreamHandler"
formatter = "default"
stream = "ext://sys.stdout"

# Formatter for structured logging
[[logging.formatters]]
name = "default"
format = "%(asctime)s %(name)s %(levelname)s %(message)s"
datefmt = "%Y-%m-%d %H:%M:%S"

# Health check endpoint
[health]
path = /health
enabled = true

# Performance tuning for Railway
[pool]
# Connection pool settings
database_maxconn = 10
database_minconn = 1
database_timeout = 300

# Worker process settings
processes = ${WORKER_PROCESSES}

# DivvyQueue specific modules
[modules]
# Core business modules for DivvyQueue
party = true
product = true
sale = true
purchase = true
account = true
stock = true
project = true
company = true
currency = true
country = true

# Optional modules (can be enabled as needed)
# account_invoice = false
# account_payment = false
# sale_opportunity = false
# purchase_request = false
# stock_forecast = false
# project_revenue = false
# timesheet = false
# commission = false
# production = false

# API rate limiting (if supported)
[ratelimit]
enabled = true
per_minute = 1000
per_hour = 10000
burst = 50

# Monitoring and metrics
[metrics]
enabled = true
endpoint = /metrics

# Development/debugging (disabled in production)
[debug]
enabled = false
sql = false
rpc = false

# Backup configuration
[backup]
enabled = true
retention_days = 30
schedule = "0 2 * * *"  # Daily at 2 AM

# Environment-specific overrides
[production]
debug.enabled = false
logging.level = INFO

[development]
debug.enabled = true
logging.level = DEBUG
cache.timeout = 60
